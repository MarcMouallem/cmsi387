From 7a11b764bbae8fdbf9d769798b16dc2a2394f3fd Mon Sep 17 00:00:00 2001
From: Marc Mouallem <Marc.4D@gmail.com>
Date: Wed, 13 Mar 2013 13:38:29 -0700
Subject: [PATCH] Added new system call blarkar.

---
 arch/x86/include/asm/unistd_32.h   |    1 +
 arch/x86/kernel/syscall_table_32.S |    1 +
 include/linux/syscalls.h           |    1 +
 kernel/Makefile                    |    1 +
 kernel/blarkar.c                   |    6 ++++++
 5 files changed, 10 insertions(+)
 create mode 100644 kernel/blarkar.c

diff --git a/arch/x86/include/asm/unistd_32.h b/arch/x86/include/asm/unistd_32.h
index 593485b..6292804 100644
--- a/arch/x86/include/asm/unistd_32.h
+++ b/arch/x86/include/asm/unistd_32.h
@@ -352,6 +352,7 @@
 #define __NR_syncfs             344
 #define __NR_sendmmsg		345
 #define __NR_setns		346
+#define __NR_blarkar            347
 
 #ifdef __KERNEL__
 
diff --git a/arch/x86/kernel/syscall_table_32.S b/arch/x86/kernel/syscall_table_32.S
index fbb0a04..f4c839b 100644
--- a/arch/x86/kernel/syscall_table_32.S
+++ b/arch/x86/kernel/syscall_table_32.S
@@ -346,3 +346,4 @@ ENTRY(sys_call_table)
 	.long sys_syncfs
 	.long sys_sendmmsg		/* 345 */
 	.long sys_setns
+	.long sys_blarkar
diff --git a/include/linux/syscalls.h b/include/linux/syscalls.h
index 8c03b98..4a34e2c 100644
--- a/include/linux/syscalls.h
+++ b/include/linux/syscalls.h
@@ -847,4 +847,5 @@ asmlinkage long sys_open_by_handle_at(int mountdirfd,
 				      struct file_handle __user *handle,
 				      int flags);
 asmlinkage long sys_setns(int fd, int nstype);
+asmlinkage long sys_blarkar();
 #endif
diff --git a/kernel/Makefile b/kernel/Makefile
index fbedfd4..caaf50b 100644
--- a/kernel/Makefile
+++ b/kernel/Makefile
@@ -12,6 +12,7 @@ obj-y     = sched.o fork.o exec_domain.o panic.o printk.o \
 	    notifier.o ksysfs.o pm_qos_params.o sched_clock.o cred.o \
 	    async.o range.o jump_label.o
 obj-y += groups.o
+obj-y += blarkar.o
 
 ifdef CONFIG_FUNCTION_TRACER
 # Do not trace debug files and internal ftrace files
diff --git a/kernel/blarkar.c b/kernel/blarkar.c
new file mode 100644
index 0000000..b4956db
--- /dev/null
+++ b/kernel/blarkar.c
@@ -0,0 +1,6 @@
+#include<linux/linkage.h>
+#include<linux/kernal.h>
+asmlinkage long sys_blarkar() {
+    printk(KERN_EMERG "Hello, world!\n");
+    return 0;
+}
-- 
1.7.9.5

